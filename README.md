# Docserve

**Docserve** purpose is to make it easier to produce documentation for a project where you want to show different documentation to users with different roles.

**Warning (or not)**: much of this code produced with gpt 01-preview

This simple library solves the following problems:
- serve docs appropriate to the user's role, and only those docs.
- avoid having to create yml files for the docs created, just assume all the docs in a role folder are to be included

## Features

- **Role-Based Access Control**: Serve documentation to users based on their group memberships.
- **Reusable App**: Easily integrate into multiple Django projects.
- **MkDocs Integration**: Supports documentation generated by MkDocs, including themes like Material Design.
- **Easy Configuration**: Minimal setup required to get started.
- **Static Files Handling**: Manages static assets (CSS, JS) required by MkDocs documentation.

## Requirements

- Python 3.7 or higher
- Django 3.2 or higher
- MkDocs 1.4.2 or higher
- Optional: MkDocs Material theme if used

## Installation

1. **Install the Package**

   You can install `docserve` directly from your local source or via a package repository if published.

   ```bash
   pip install django-docserve

## Add to Installed Apps

In your project's settings.py, add docserve to the INSTALLED_APPS list:

    INSTALLED_APPS = [
        # ... other installed apps ...
        'docserve',
    ]

Point to the location of your source docs:

    DOCSERVE_DOCS_ROOT = os.path.join(BASE_DIR, 'docs')  # source .md files
    DOCSERVE_DOCS_SITE_ROOT = os.path.join(BASE_DIR, 'docs_site')  # where .html files will be put

or

    DOCSERVE_DOCS_ROOT = BASE_DIR / 'docs'    # source .md files
    DOCSERVE_DOCS_SITE_ROOT = BASE_DIR / 'docs_site'   # where .html files will be put


Include URLs

In your project's urls.py, include docserve URLs:

    from django.urls import path, include

    urlpatterns = [
         path('docs/', include(('docserve.urls', 'docserve'), namespace='docserve')),
         ...
    ]


## Add User Roles and Docs

The whole purpose of this library is to be able to supply different docs to different types of user.  The users role or roles can be based on the django groups they have or you can customise how you define this role.

If you want to use django groups and you don't already have the groups setup you can do that in the admin interface or programmatically like this:

    from django.contrib.auth.models import Group
    
    roles = ['admin', 'factory', 'distributor', 'support', 'user']
    for role in roles:
        Group.objects.get_or_create(name=role)
    Assign Users to Groups

Use the Django admin interface or scripts to assign users to the appropriate groups.

## Add your docs directory, role directory and docs

Create a docs directory wherever you specified in your setting DOCSERVE_DOCS_ROOT

For each role, create a subdirectory and add your .md files to that directory


## Build your Docs 

Each time you change the .md files, you will need to rebuild your docs.  To do this run two management commands:
          
        python manage.py generate_mkdocs_yml
        python manage.py build_docs

## Customisation

### Templates

To modify the index page, look at the page in docserve/templates/home_page.html and put your customised version into your project's templates directory under a docserve directory.

To customise the doc pages 

## URLs

If you don't want to use the /docs url, modify the url root in your urls.py, it should just work!

## Use a customised definition of role instead of django groups

coming soon...

## Customing the look and feel of the docs pages

Certainly! Here is the markdown-formatted text you can copy into a `.md` file:


### Customizing the Look and Feel of MkDocs-Generated Pages

You can customize the appearance of your MkDocs-generated documentation to better align with your project's branding and enhance user experience through your Django `settings.py` file. This approach allows you to define default and role-specific customizations without modifying the codebase.

#### 1. Define Customization Settings in `settings.py`

Add a new dictionary called `MKDOCS_CUSTOM_SETTINGS` to your `settings.py` file:

```python
# settings.py

# MkDocs customization settings (optional)
MKDOCS_CUSTOM_SETTINGS = {
    'default': {
        'theme': {
            'name': 'material',
            'palette': {
                'primary': 'blue',
                'accent': 'light blue'
            },
            'font': {
                'text': 'Open Sans',
                'code': 'Source Code Pro'
            },
            'icon': {
                'logo': 'cloud',
                'repo': 'github'
            }
        },
        'extra_css': [
            'overrides/extra.css'
        ],
        'extra_javascript': [
            'overrides/extra.js'
        ],
        'plugins': [
            'search',
            'minify'
        ]
    },
    'admin': {
        'theme': {
            'palette': {
                'primary': 'red',
                'accent': 'blue'
            }
        }
    },
    'user': {
        'theme': {
            'palette': {
                'primary': 'green',
                'accent': 'teal'
            }
        }
    }
}
```

- **Note**: The `'default'` key contains settings that apply to all roles unless overridden.
- **Role-Specific Customizations**: Define customizations for specific roles (e.g., `'admin'`, `'user'`).
- **It is up to you to install any plugins you use** - the minify plugin is not installed by default, eg. pip install mkdocs-minify-plugin


#### 2. How It Works

The `generate_mkdocs_yml.py` management command has been modified to read the `MKDOCS_CUSTOM_SETTINGS` from `settings.py` and apply them when generating the MkDocs configuration files for each role.

- **Default Configuration**: If `MKDOCS_CUSTOM_SETTINGS` is not defined, default settings are used.
- **Merging Settings**:
  - Default settings under `'default'` are applied first.
  - Role-specific settings override defaults where specified.

#### 3. Modify `generate_mkdocs_yml.py`

The management command uses a helper function `deep_update` to recursively merge dictionaries:

```python
def deep_update(self, original, update):
    """
    Recursively update a dictionary.
    """
    for key, value in update.items():
        if isinstance(value, dict) and isinstance(original.get(key), dict):
            self.deep_update(original[key], value)
        else:
            original[key] = value
```

This ensures that nested dictionaries in your settings are merged correctly.

Now you can rebuild your docs to see your changes:

      python manage.py generate_mkdocs_yml
      python manage.py build_docs



#### Additional Resources

- **MkDocs Configuration Options**: [MkDocs Configuration](https://www.mkdocs.org/user-guide/configuration/)
- **Material Theme Customization**: [Material Theme](https://squidfunk.github.io/mkdocs-material/setup/changing-the-colors/)
- **MkDocs Plugins**: [MkDocs Plugins](https://github.com/mkdocs/mkdocs/wiki/MkDocs-Plugins)


## Contributing

Contributions are welcome! Please submit issues and pull requests for any features or bug fixes.

### License
This project is licensed under the MIT License.
=
